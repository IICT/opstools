<!DOCTYPE html>
<html>
<head>
	<title>Use SSH to log into your virtual machine</title>
  	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="http://iict.github.io/opstools/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://iict.github.io/opstools/static/css/heig-cloud-home.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="http://iict.github.io/opstools/static/img/favicon.png" />

</head>
<body>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


     
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://iict.github.io/opstools/">IICT Ops Tools</a>
            </div>
            
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><a href="http://iict.github.io/opstools/">Home</a></li>
                    <li><a href="http://iict.github.io/opstools/article/">Articles</a></li>
                    <li><a href="http://iict.github.io/opstools/about/">About</a></li>
                    <li><a href="http://www.heig-vd.ch">HEIG-VD website</a></li>
                </ul>
            </div>
            
        </div>
        
    </nav>

    
	<div class="container">
	    <div class="row">

	        
	        <div class="col-lg-8">

	            
	            <h2><a href="http://iict.github.io/opstools/article/ssh">Use SSH to log into your virtual machine</a></h2>
	            <p class="lead">
	                by <a href="http://iict.github.io/opstools/">IICT Team</a>
	            </p>
	            <p><span class="glyphicon glyphicon-time"></span> Posted on Fri, Feb 19, 2016</p>

	            <hr>
	            
	            

<p>Professional developers and system administrators working with Linux servers often re-create the server environment on their local machine by running Linux with the server applications in a virtual machine. They are used to work on the command line and they connect to the remote servers via SSH. To access the local Linux VM they use SSH as well instead of using the VirtualBox/VMware console, because they can keep using the same keystrokes and work faster. In this article we explain how to set up SSH to connect from a host machine to a Linux guest VM.</p>

<h3 id="for-windows-users-only-install-git-bash:b5e789e001cfcd9a18b36ef13da96386">(For Windows users only:) Install Git bash</h3>

<p>To connect to another machine via SSH you need an SSH client program on your Windows machine. A popular option is to use <a href="http://www.putty.org">Putty</a>, but we recommend <strong>Git Bash</strong> instead as it is easier to use. Git Bash has also the nice feature that it provides an emulation of the Bash shell and allows you (more or less) to use Linux commands from a terminal on a Windows machine.</p>

<ol>
<li><p>Download Git Bash</p>

<p>Download it here: <a href="https://git-for-windows.github.io/">https://git-for-windows.github.io/ </a></p></li>

<li><p>Installation</p>

<ul>
<li>Select components: default</li>
<li>Use Git from Git bash only</li>
<li>Checkout-windows Style, commit Unix-style line endings</li>
<li>Use MinTTY</li>
</ul></li>

<li><p>Launch it</p>

<p>You should now have the program called <strong>Git Bash</strong>.
In the terminal you can work with the directory <code>/home/your_name</code>, it is mapped to the directory <code>C:\Users\your_name\</code> in the real file system. So if you were doing for example on Linux:</p>

<pre><code># Linux: Go to the SSH configuration directory 
$ cd ~/.ssh
$ pwd
/home/administrator/.ssh
</code></pre>

<p>you can do the equivalent in Bash shell on Windows</p>

<pre><code># Bash shell on Windows: Go to the SSH configuration directory
$ cd ~/.ssh
$ pwd
/c/Users/your_name/.ssh
</code></pre></li>
</ol>

<p>You should now be able to follow the rest of the instructions on how to set up SSH.</p>

<p><strong>Caution:</strong> When you are asked in a lab to work with Bash (command line or scripts), don&rsquo;t use Git Bash to do the lab, as it is not a real Bash shell. Use it only to <strong>connect</strong> to a machine where a real Bash shell is running.</p>

<h3 id="configure-the-virtualization-software-to-forward-port-2222-to-port-22:b5e789e001cfcd9a18b36ef13da96386">Configure the virtualization software to forward port 2222 to port 22</h3>

<p>In this section we change the networking configuration of the virtualization software so that the SSH client on your host can connect to the SSH server on your guest VM.</p>

<p>Note that the configuration is different if you are using VirtualBox or VMware, as the networking component attaching the virtual machine to your host works differently. In the following we describe the configuration of VirtualBox.</p>

<p>Configure the networking of the virtual machine to forward incoming connections to port 2222 of address 127.0.0.1 to the SSH port (=22) of the virtual machine:</p>

<ul>
<li>Navigate to <strong>Settings &gt; Network &gt; Adapter 1.</strong></li>
<li>For <strong>Attached to:</strong> choose <strong>NAT</strong>.</li>
<li>Click on <strong>Port Forwarding</strong>. Create a rule that maps incoming <strong>TCP</strong> connections on host IP <strong>127.0.0.1</strong>, port <strong>2222</strong> to guest port <strong>22</strong>.</li>
</ul>

<p>To connect to your Linux machine via SSH an SSH server needs to run on it. The SSH server should have been installed already when you installed Linux, but let&rsquo;s check nonetheless. Open a command line on your VM and type:</p>

<pre><code>$ sudo apt-get update
$ sudo apt-get install openssh-server 
</code></pre>

<h3 id="create-a-keypair:b5e789e001cfcd9a18b36ef13da96386">Create a keypair</h3>

<p>There are generally two ways to log into a machine with SSH:</p>

<ul>
<li>Authenticate by providing a username and password</li>
<li>Authenticate by providing a username and a keypair</li>
</ul>

<p>Keypairs have a big advantage: they are much harder to crack for an adversary (this improves security a lot). Keypairs can be themselves protected by a password, but this is optional. When using a keypair you can choose to log into a machine without needing to type a password (this decreases security slightly).</p>

<p>In this section we describe how to set up authentication with a (passwordless) keypair. Here is an overview of the procedure:</p>

<ol>
<li>Log into the Linux VM using username and password.</li>
<li>On the Linux VM create an SSH configuration directory and generate a keypair.</li>
<li>On the host machine create an SSH configuration directory and transfer the private key of the keypair to the host machine.</li>
<li>Use the new keypair to login.</li>
</ol>

<p>In the following we explain the steps in more detail.</p>

<h4 id="log-into-the-linux-vm-using-username-and-password:b5e789e001cfcd9a18b36ef13da96386">Log into the Linux VM using username and password</h4>

<p>Open a terminal on your host and type:</p>

<pre><code>    $ ssh -p 2222 administrator@127.0.0.1
</code></pre>

<p>As you are using SSH for the first time to connect to a new host, SSH will print a warning like this:</p>

<pre><code>RSA key fingerprint is xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx.
Are you sure you want to continue connecting (yes/no)? yes
</code></pre>

<p>This is completely normal, so just type <strong>yes</strong>.</p>

<p>If it works, you will see the command line prompt of the Linux VM, which should look like this:</p>

<pre><code>administrator@ubuntu:~$ 
</code></pre>

<p>You are now logged into the Linux VM via SSH and every command you type in this terminal will be executed on the Linux VM.</p>

<h4 id="on-the-linux-vm-create-an-ssh-configuration-directory-and-generate-a-keypair:b5e789e001cfcd9a18b36ef13da96386">On the Linux VM create an SSH configuration directory and generate a keypair</h4>

<p>This involves the following steps:</p>

<ol>
<li><p>Create the SSH configuration directory <code>~/.ssh</code> and protect it from outside access</p>

<pre><code>$ mkdir ~/.ssh
$ chmod go-rwx ~/.ssh 
</code></pre></li>

<li><p>Create a new keypair which will become your personal authentication token. Use your HEIG-VD email address to identify the key.</p>

<pre><code>$ ssh-keygen -t rsa -b 4096 -C &quot;your.name@heig-vd.ch&quot;
Generating public/private rsa key pair.
Enter file in which to save the key (/home/administrator/.ssh/id_rsa): 
Created directory '/home/administrator/.ssh'.
Enter passphrase (empty for no passphrase): #Press ENTER
Enter same passphrase again: #Press ENTER 
Your identification has been saved in /home/administrator/.ssh/id_rsa.
Your public key has been saved in /home/administrator/.ssh/id_rsa.pub.
The key fingerprint is:
xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx: your.name@heig-vd.ch
The key's randomart image is:
+--[ RSA 4096]----+
|         .       |
|        . .      |
|         . .     |
|      .   ...    |
|     . .So...    |
|      o o=o. +   |
|       o..E.o .  |
|        .+ *.    |
|        ..+o.    |
+-----------------+
</code></pre>

<p>Your private key can now be found in the file <code>id_rsa</code>, your public key is in the file <code>id_rsa.pub</code>. Both keys are plain text files.</p></li>

<li><p>You now need to add your public key to the file <code>authorized_keys</code> (which does not yet exist). Simply copy your public key to a new file called <code>authorized_keys</code>:</p>

<pre><code>$ cp ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
</code></pre></li>
</ol>

<h4 id="on-the-host-machine-create-an-ssh-configuration-directory-and-transfer-the-private-key-of-the-keypair-to-the-host-machine:b5e789e001cfcd9a18b36ef13da96386">On the host machine create an SSH configuration directory and transfer the private key of the keypair to the host machine.</h4>

<p>On your host machine open a second terminal. Create the SSH configuration directory <code>~/.ssh</code> and protect it from outside access</p>

<pre><code>    $ mkdir ~/.ssh
    $ chmod go-rwx ~/.ssh 
</code></pre>

<p>To transfer the private key from guest to host we will use your host machine&rsquo;s clipboard (copy and paste):</p>

<ol>
<li><p>On the Linux VM display the key using the <code>cat</code> command:</p>

<pre><code>$ cat ~/.ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
...............................
...............................
-----END RSA PRIVATE KEY-----
</code></pre>

<p>Select the text and copy it to the clipboard.</p></li>

<li><p>On the host machine, use the <code>nano</code> text editor create a new file <code>id_rsa</code> in the directory <code>~/.ssh</code>:</p>

<pre><code>$ nano ~/.ssh/id_rsa
</code></pre></li>
</ol>

<p>Paste the content of the clipboard into the editor. Type <strong>Ctrl-O</strong> to
save the file and <strong>Ctrl-X</strong> to exit the editor.</p>

<ol>
<li><p>On the Linux VM you can now log out:</p>

<pre><code>$ exit 
# Will close the ssh connection
</code></pre></li>
</ol>

<h4 id="use-the-new-keypair-to-login:b5e789e001cfcd9a18b36ef13da96386">Use the new keypair to login.</h4>

<p>You should be able to connect to your Linux VM without needing to specify a password, like this:</p>

<pre><code>    $ ssh -p 2222 administrator@127.0.0.1
    Welcome to Ubuntu 14.04.3 LTS (GNU/Linux 3.13.0-44-generic x86_64)
    [...]
    administrator@ubuntu:~$ 
</code></pre>

	            <hr>

	            <div id="disqus_thread"></div>
				<script>
				    

				    



				    (function() {  
				        var d = document, s = d.createElement('script');
				        
				        s.src = '//iictopstools.disqus.com/embed.js';
				        
				        s.setAttribute('data-timestamp', +new Date());
				        (d.head || d.body).appendChild(s);
				    })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

	        </div>




            <div class="col-md-4">

                
                <div class="well">
                    <h4>Last posts</h4>
                    <div class="row">
                        <div class="col-lg-6">
                            <ul class="list-unstyled">
                              
                                
                                  <li><a href="http://iict.github.io/opstools/article/troubleshooting">Troubleshooting</a></li>
                                
                              
                                
                                  <li><a href="http://iict.github.io/opstools/article/tools">Integrate your virtual machine with your local machine</a></li>
                                
                              
                                
                                  <li><a href="http://iict.github.io/opstools/article/ssh">Use SSH to log into your virtual machine</a></li>
                                
                              
                                
                                  <li><a href="http://iict.github.io/opstools/article/install_linux">Install Linux on a VM</a></li>
                                
                              
                                
                              
                            </ul>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <ul class="list-unstyled">
                            <li><strong><a href="http://iict.github.io/opstools/article/">See all articles</a></strong></li>
                            </ul>
                        </div>
                    </div>
                    
                </div>

                
                <div class="well">
                    <h4>Social</h4>
                    <div class="fb-page" data-href="https://www.facebook.com/HEIGVD/" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/HEIGVD/"><a href="https://www.facebook.com/HEIGVD/">HEIG-VD (Haute Ecole d&#039;Ingénierie et de Gestion du Canton de Vaud)</a></blockquote></div></div>
                </div>

            </div>
        </div>

        <footer>
            <div class="row">
                <div class="col-lg-12">
                	<p><a href="#top">Go back to the top</a></p>
                    <p>Copyright &copy; HEIG-VD, 2015. Content generated with <a href="http://gohugo.io/">Hugo</a>.</p>
                </div>
                
            </div>
            
        </footer>

    </div>
    <script src="http://iict.github.io/opstools/static/js/jquery.js"></script>

    
    <script src="http://iict.github.io/opstools/static/js/bootstrap.min.js"></script>
</body>
</html>